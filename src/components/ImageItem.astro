---
import type { Artwork } from '../lib/artworks';

interface Props {
	artwork: Artwork;
	lazy?: boolean;
}

const { artwork, lazy = false } = Astro.props;
const { width, height } = artwork.imageDimensions.small;
const aspectRatio = (height / width) * 100;
---

<figure class="relative group block overflow-hidden rounded-md">
	<a href={`/artwork/${artwork.objectID}/`} class="block relative cursor-pointer">
		{lazy ? (
			<div class="relative w-full" style={`padding-bottom: ${aspectRatio}%`}>
				<!-- Skeleton loader placeholder -->
				<div class="skeleton-loader absolute inset-0 bg-gray-warm-800 rounded-md"></div>
				<img
					data-src={artwork.images.small}
					alt={`${artwork.title}${artwork.artistDisplayName ? ` by ${artwork.artistDisplayName}` : ''}`}
					width={width}
					height={height}
					class="lazy-image absolute inset-0 w-full h-full rounded-md opacity-0 transition-opacity duration-300"
				/>
			</div>
		) : (
			<img
				src={artwork.images.small}
				alt={`${artwork.title}${artwork.artistDisplayName ? ` by ${artwork.artistDisplayName}` : ''}`}
				width={width}
				height={height}
				class="w-full rounded-md block"
				loading="eager"
				fetchpriority="high"
			/>
		)}
	</a>
	<figcaption
		class="absolute inset-0 bg-gray-warm-950/70 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4 rounded-md pointer-events-none"
	>
		<h3 class="text-primary text-lg">{artwork.title}</h3>
		{artwork.artistDisplayName && <p class="text-gray-warm-300 text-sm">{artwork.artistDisplayName}</p>}
		{artwork.objectDate && <p class="text-gray-warm-400 text-xs mt-1">{artwork.objectDate}</p>}
		{
			artwork.medium && (
				<p class="text-gray-warm-300 text-sm mt-2 line-clamp-3">{artwork.medium}</p>
			)
		}
	</figcaption>
</figure>
