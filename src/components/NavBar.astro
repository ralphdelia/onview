<nav class="mx-auto my-4 shrink-0">
	<div class="flex items-center justify-between">
		<a
			href="/"
			class="text-xl ml-2 text-primary hover:opacity-50 cursor-pointer transition-opacity duration-200"
		>
			OnView
		</a>
		<ul class="flex gap-4 items-center">
			<li>
				<a
					href="/explore/"
					class="text-primary p-2 hover:opacity-50 cursor-pointer transition-opacity duration-200"
				>
					Explore
				</a>
			</li>
			<li>
				<a
					href="/search/"
					class="text-primary p-2 hover:opacity-50 cursor-pointer transition-opacity duration-200"
				>
					Search
				</a>
			</li>
			<li>
				<button
					id="random-artwork-btn"
					class="text-primary p-2 hover:opacity-50 transition-opacity duration-200 cursor-pointer"
				>
					Random
				</button>
			</li>
		</ul>
	</div>
</nav>

<script>
	let artworkIds: number[] | null = null;
	let fetchPromise: Promise<void> | null = null;

	async function loadArtworkIds() {
		if (fetchPromise) return fetchPromise;

		fetchPromise = fetch('/artwork-ids.json')
			.then((response) => response.json())
			.then((data) => {
				artworkIds = data;
			})
			.catch((error) => {
				console.error('Failed to load artwork IDs:', error);
				fetchPromise = null;
			});

		return fetchPromise;
	}

	async function navigateToRandomArtwork() {
		await loadArtworkIds();

		if (artworkIds && artworkIds.length > 0) {
			const randomId =
				artworkIds[Math.floor(Math.random() * artworkIds.length)];
			window.location.href = `/artwork/${randomId}/`;
		}
	}

	// Don't preload - only load when button is clicked

	const button = document.getElementById('random-artwork-btn');
	button?.addEventListener('click', navigateToRandomArtwork);
</script>
